# Ralph Progress Log
---

## 2026-01-20T21:04 - US-001 Create Prompt File Structure
- Created `backend/system_prompts/` directory
- Created all 5 prompt files:
  - `orchestrator.txt` - Request routing instructions
  - `aci.txt` - Cisco ACI fabric diagnostics
  - `infoblox.txt` - IPAM and DNS queries
  - `palo_alto.txt` - Firewall diagnostics
  - `triage.txt` - SRE analysis instructions
- Files changed: 5 new files in `backend/system_prompts/`
- **Learnings:**
  - Sub-agents (ACI, Infoblox, Palo Alto) currently use `create_react_agent()` without explicit system prompts
  - Triage agent has hardcoded prompt in `triage.py` lines 47-54
  - Orchestrator uses `config.system_prompt` plus inline additions
---

## 2026-01-20T21:08 - US-002 Implement Prompt Loading Utility
- Added `load_system_prompt(agent_name: str) -> str` function to `backend/src/config.py`
- Uses `pathlib.Path` for cross-platform path resolution
- Added `DEFAULT_PROMPTS` dict with fallback prompts for all 5 agents
- Logs warnings when file not found, debug when successfully loaded
- Files changed: `backend/src/config.py`
- **Learnings:**
  - PowerShell doesn't support `&&` for chaining commands, use `;` or separate commands
  - `Path(__file__).resolve().parent.parent / "system_prompts"` works for Docker `/app/src` structure
---

## 2026-01-20T21:12 - US-003 Update Orchestrator to Use Configurable Prompt
- Updated `backend/src/orchestrator.py` to import and use `load_system_prompt('orchestrator')`
- Replaced `config.system_prompt` with configurable prompt loading
- Prompt is now read from `backend/system_prompts/orchestrator.txt`
- Files changed: `backend/src/orchestrator.py`
- **Learnings:**
  - The orchestrator prompt can now be hot-reloaded from the text file
  - Fallback mechanism ensures backward compatibility
---

## 2026-01-20T21:23 - US-004 Update Sub-Agents with Configurable Prompts
- Updated aci.py, infoblox.py, palo_alto.py to use load_system_prompt
- Passed system prompt to create_react_agent via state_modifier
- Validated with mypy
- Files changed: backend/src/sub_agents/aci.py, backend/src/sub_agents/infoblox.py, backend/src/sub_agents/palo_alto.py
- **Learnings:**
  - create_react_agent accepts state_modifier for system prompts
---

## 2026-01-20T21:26 - US-005 Update Triage Agent with Configurable Prompt
- Updated `backend/src/sub_agents/triage.py` to use `load_system_prompt('triage')`
- Replaced hardcoded prompt with file-based loading
- Validated with mypy
- Files changed: `backend/src/sub_agents/triage.py`
- **Learnings:**
  - Triage agent uses `llm.with_structured_output`, but the system prompt is passed via `SystemMessage` in the invoke call, not via agent state modifier like the other agents.
---

## 2026-01-20T21:30 - US-006 Add Unit Tests for Prompt Loading
- Created `backend/tests/test_config.py`
- Implemented unit tests for `load_system_prompt`
- Verified tests pass with `pytest`
- Files changed: `backend/tests/test_config.py`
- **Learnings:**
  - Need to ensure `PYTHONPATH` includes `backend` when running tests from root.
  - `pathlib.Path.read_text` should be mocked directly instead of `builtins.open` when used.
---



## 2026-01-20T21:26 - US-007 Update backend/readme
- Updated `backend/README.md` to document Configurable System Prompts feature.
- Added details on directory structure (`backend/system_prompts/`), editing instructions, and fallback mechanism.
- Clarified hot-reload behavior for Orchestrator/Triage vs restart requirement for sub-agents.
- Files changed: `backend/README.md`
- **Learnings:**
  - Confirmed Orchestrator and Triage reload prompts on every request (hot-reload).
  - Confirmed sub-agents (ACI, Infoblox, Palo Alto) load prompts only on startup (cold-load).
  - This distinction is critical for developers iterating on prompts.
---
