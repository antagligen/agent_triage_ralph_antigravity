# Ralph Progress Log
---

## 2026-01-20T21:49 - US-001 Fix create_react_agent TypeError
- Fixed TypeError in `create_react_agent` by renaming `state_modifier` argument to `prompt`.
- Updated `backend/src/sub_agents/aci.py`, `backend/src/sub_agents/infoblox.py`, and `backend/src/sub_agents/palo_alto.py`.
- Files changed: `backend/src/sub_agents/aci.py`, `backend/src/sub_agents/infoblox.py`, `backend/src/sub_agents/palo_alto.py`
- **Learnings:**
  - The installed version of `langgraph` uses `prompt` instead of `state_modifier` in `create_react_agent`.
  - Manual verification script `verify_agents.py` confirmed the fix.
---

## 2026-01-20T22:07 - US-002 Add Pre-commit Hooks
- Added .pre-commit-config.yaml with pytest and mypy hooks.
- Created pytest.ini to exclude archive and focus on tests.
- Created mypy.ini to configure checks and exclude archive.
- Fixed type annotations in backend/tests/test_triage.py, backend/tests/test_orchestrator.py, backend/tests/test_orchestrator_parallel.py.
- **Learnings:**
  - mypy requires explicit configuration to play nice with pre-commit and existing code.
  - Tests needed loose type annotations (Dict[str, Any]) to satisfy strict checks without massive refactoring.
---

## 2026-01-20T22:25 - US-003 Fix current pytest that is failing
- Fixed incorrect patch path in `backend/tests/test_config.py`.
- Verified `pytest` passes (36 passed, 33 warnings).
- Verified `pre-commit run --all-files` passes.
- Files changed: `backend/tests/test_config.py`
- **Learnings:**
  - Mocking/patching requires the full module path matching the import in the test file.
---

## 2026-01-20T22:36 - US-004 Add Agent Integration Tests
- Rewrote `backend/tests/test_agents.py` with comprehensive integration tests using proper mocks.
- Verified instantiation and prompt loading for ACI, Infoblox, Palo Alto, Orchestrator, and Triage agents.
- Verified that all tests pass (`pytest` and `pre-commit run --all-files`).
- Files changed: `backend/tests/test_agents.py`
- **Learnings:**
  - `create_react_agent` logic was verified to use `prompt` correctly.
  - Patching modules requires targeting the specific module where the symbol is imported or used.
---

## 2026-01-20T22:35 - US-005 Fix Entrypoint CRLF Issue
- Diagnosed "no such file or directory" error for entrypoint as a CRLF line-ending issue on Windows.
- Verified local file `backend/entrypoint.sh` had CRLF endings.
- Updated `backend/Dockerfile` to strip carriage returns using `sed` during build.
- Files changed: `backend/Dockerfile`
- **Learnings:**
  - On Windows, `git` often checkouts files with CRLF. Docker copies them as-is.
  - Linux shells (bash) interpret `\r` as part of the filename in the shebang, leading to confusing "no such file" errors.
  - Using `sed -i 's/\r$//'` in Dockerfile is a robust fix for cross-platform compatibility.
---
